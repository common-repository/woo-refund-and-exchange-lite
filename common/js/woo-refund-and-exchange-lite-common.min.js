jQuery((function(r){r(".wps_rma_return_notification").hide(),r("#wps_rma_return_request_form").on("submit",(function(e){e.preventDefault();var _=r(this).data("orderid"),a=r(".wps_rma_total_refund_price").val(),o="",t={},s=0,n="",m=wrael_common_param.check_pro_active,p=r("#wps_rma_return_request_subject").val();""!=p&&null!=p||""!=(p=r("#wps_rma_return_request_subject_text").val())&&null!=p||(o+="<li>"+wrael_common_param.return_subject_msg+"</li>");var c=r(".wps_rma_return_request_reason").val();if(void 0===c||""!=c&&null!=c||(o+="<li>"+wrael_common_param.return_reason_msg+"</li>"),m&&"function"==typeof wps_rma_return_alert_condition_addon){var i=wps_rma_return_alert_condition_addon();i&&(o+=i)}var d=wrael_common_param.refund_form_attachment;d&&"on"==d&&r(".wps_rma_return_request_files").each((function(){var e=r(this);if(e[0].files.length){var _=e[0].files[0].type;"image/png"==_||"image/jpeg"==_||"image/jpg"==_||(o+="<li>"+wrael_common_param.file_not_supported+"</li>")}}));var l=null;if(m){if("function"==typeof wps_rma_refund_total){var u=wps_rma_refund_total();t=u.selected_product,a=u.amount}l=r("#wps_rma_customer_contact_refund").val()}else r(".wps_rma_return_column").each((function(){if(r(this).find("td:eq(0)").children(".wps_rma_return_product")){var e={},_=r(this).data("variationid"),a=r(this).data("productid"),o=r(this).data("itemid"),n=r(this).find("td:eq(0)").children(".wps_rma_product_amount").val(),m=r(this).find(".wps_rma_return_product_qty").val();e.product_id=a,e.variation_id=_,e.item_id=o,e.price=n,e.qty=m,t[s]=e,s++}}));var w=!1;r.each(t,(function(r,e){parseInt(e.qty)||(w=!0)})),w&&(o+="<li>"+wrael_common_param.qty_error+"</li>");var f=0;if(r(".wps_wrma_return_product_all").is(":checked")&&(f=1),""!=o)return r("#wps_rma_return_alert").show(),r("#wps_rma_return_alert").html(o),r("#wps_rma_return_alert").addClass("woocommerce-error"),r("#wps_rma_return_alert").removeClass("woocommerce-message"),r("#wps_rma_return_alert").css("background-color","red"),r("html, body").animate({scrollTop:r("#wps_rma_return_request_container").offset().top},800),!1;r("#wps_rma_return_alert").hide(),r("#wps_rma_return_alert").html(o),m&&"function"==typeof wps_rma_refund_method&&(n=wps_rma_refund_method());var g={action:"wps_rma_save_return_request",products:t,amount:a,subject:p,reason:c,orderid:_,bankdetails:r("#wps_rma_bank_details").val(),refund_method:n,security_check:wrael_common_param.wps_rma_nonce,all_product_checked:f,wps_rma_customer_contact_refund:l},h=new FormData(this);h.append("action","wps_rma_return_upload_files"),h.append("security_check",wrael_common_param.wps_rma_nonce),r(".wps_rma_return_notification").show(),r.ajax({url:wrael_common_param.ajaxurl,type:"POST",data:h,contentType:!1,cache:!1,processData:!1,success:function(e){r.ajax({url:wrael_common_param.ajaxurl,type:"POST",data:g,dataType:"json",success:function(e){var a=10;setInterval((function(){a>=0&&r("#countdownTimer").html(a),a-=1}),1e3);r("#wps_rma_return_alert").removeClass("woocommerce-error"),r("#wps_rma_return_alert").addClass("woocommerce-message"),r("#wps_rma_return_alert").css("background-color","#8FAE1B"),r("#wps_rma_return_alert").show(),r("#wps_rma_return_alert").html(e.msg+' in <b><span id="countdownTimer"></span> seconds</b>'),r(".wps_rma_return_notification").hide(),r("html, body").animate({scrollTop:r("#wps_rma_return_request_container").offset().top},800),void 0!==e.auto_accept&&1==e.auto_accept?"function"==typeof wps_rma_refund_auto_accept&&wps_rma_refund_auto_accept(_):window.setTimeout((function(){window.location.href=wrael_common_param.myaccount_url}),11e3)}})}})})),r(document).on("click",".wps_remove_notice_msg",(function(e){e.preventDefault(),r(".wps_order_msg_notice_wrapper").hide()})),r(document).on("click","#wps_order_msg_submit",(function(e){e.preventDefault();var _=r("#wps_order_msg_attachment"),a=r("#wps_order_new_msg").val(),o=r("#order_msg_type").val(),t="",s=r(this).data("id"),n=null;wrael_common_param.check_pro_active&&(n=r("#wps_rma_customer_contact_order_message").val());var m=new FormData,p=wrael_common_param.order_msg_attachment;if(p&&"on"==p&&_[0]){var c=_[0].files.length;if(c)for(var i=0;i<c;i++){var d=_[0].files[i].type;"image/png"==d||"image/jpeg"==d||"image/jpg"==d?m.append("wps_order_msg_attachment[]",_[0].files[i]):t='<p class="wps_order_msg_sent_notice">'+wrael_common_param.file_not_supported+'</p><a href="" class="wps_remove_notice_msg">X</a>'}}if(""==a&&(t='<p class="wps_order_msg_sent_notice">'+wrael_common_param.message_empty+'</p><a href="" class="wps_remove_notice_msg">X</a>'),t)return r(".wps_order_msg_notice_wrapper").css("display","flex"),r(".wps_order_msg_notice_wrapper").css("background-color","red"),r(".wps_order_msg_notice_wrapper").html(t),r("#wps_order_msg_submit").css({"outline-color":"white","border-color":"white"}),!1;m.append("action","wps_rma_order_messages_save"),m.append("msg",a),m.append("order_msg_type",o),m.append("wps_rma_customer_contact_order_message",n),m.append("order_id",s),m.append("security_check",wrael_common_param.wps_rma_nonce),r.ajax({url:wrael_common_param.ajaxurl,type:"post",data:m,dataType:"json",contentType:!1,processData:!1,success:function(e){if(e){var _='<p class="wps_order_msg_sent_notice">'+wrael_common_param.message_sent+'</p><a href="" class="wps_remove_notice_msg">X</a>';r(".wps_order_msg_notice_wrapper").css("background-color","#64CD83"),r(".wps_order_msg_notice_wrapper").css("display","flex"),r("#wps_order_msg_submit").css({"outline-color":"none","border-color":"none"}),r(".wps_order_msg_sub_container").load(document.URL+" .wps-order-msg__row"),r("#wps_order_new_msg").val(""),r("#wps_order_msg_attachment").val(""),r(".wps_order_msg_notice_wrapper").html(_)}}})})),r(".wps_order_msg_reload_notice_wrapper").hide(),r(document).on("click",".wps_reload_messages",(function(e){e.preventDefault(),r(this).addClass("wps-loader-icon"),r(".wps_order_msg_sub_container").load(document.URL+" .wps-order-msg__row"),setTimeout((function(){r(".wps_reload_messages").removeClass("wps-loader-icon"),r(".wps_order_msg_reload_notice_wrapper").show(),r(".wps_order_msg_reload_notice_wrapper").css({"background-color":"rgb(100, 205, 131)","border-radius":"5px",color:"white","padding-left":"10px"})}),2e3),setTimeout((function(){r(".wps_order_msg_reload_notice_wrapper").hide()}),3e3)})),r(document).on("click",".wps_order_send_msg_dismiss",(function(e){e.preventDefault(),r(".wps_order_msg_notice_wrapper").hide()}))}));